<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - FilmFolio</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/script.js" defer></script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-brand">FilmFolio</div>
        <ul class="nav-links">
            <li><a href="home.html" class="active">Home</a></li>
            <li><a href="watched.html">Watched</a></li>
            <li><a href="my-list.html">To Watch</a></li>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="help.html">Help</a></li>
        </ul>
    </nav>


    <main class="home-content">
        <h1 id="welcome-message" class="cursive-heading"></h1>
        <p class="subheading">Here are some films you might enjoy...</p>
        <a href="watched.html" class="start-button" style="margin-bottom: 3rem; display: inline-block;">View Watched Films</a>

        <div class="movie-grid">
            <!-- Movie cards will be generated by JavaScript -->
        </div>

        <div class="pagination">
           <button id="prev-button" class="start-button">&larr; Previous</button>
           <button id="next-button" class="start-button">Next &rarr;</button>
        </div>
    </main>

    <!-- Hidden Movie Detail Modal -->
    <div id="movie-detail-modal" class="modal-container" style="display: none;">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div class="modal-layout">
                <div class="modal-cover">
                    <img id="modal-movie-img" src="" alt="Movie Cover">
                </div>
                <div class="modal-info">
                    <h2 id="modal-movie-title" class="cursive-heading" style="margin-bottom: 1rem;"></h2>
                    <p id="modal-movie-summary"></p>
                    <div class="modal-actions">
                        <div class="rating-stars">
                            <!-- Stars will be generated here -->
                        </div>
                        <textarea id="modal-movie-review" class="movie-review-textarea" placeholder="Your thoughts on the film..."></textarea>
                        <div class="modal-buttons">
                            <button id="modal-save-review-btn" class="start-button save-review-btn">Save Review</button>
                            <button id="modal-add-to-list-btn" class="start-button towatch-btn">Add to List</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="popup-notification" class="popup" style="display: none;"></div>

   <script>
        document.addEventListener('DOMContentLoaded', function() {
            const username = localStorage.getItem('filmFolioUsername');
            const welcomeMessage = document.getElementById('welcome-message');
            if (username) {
                welcomeMessage.textContent = `Welcome, ${username}!`;
            } else {
                welcomeMessage.textContent = 'Welcome!';
            }
            // Store all movie data in localStorage for other pages to use
            localStorage.setItem('filmFolioAllMovies', JSON.stringify(movies));

            displayMovies(); // Initial display
            setupModal();
        });

        const movies = [
           { title: 'Dead Poets Society', img: 'https://m.media-amazon.com/images/I/61wfHMgTmiL._AC_UF894,1000_QL80_.jpg', summary: 'An unconventional English teacher inspires his students through poetry.' },
           { title: 'Lady Bird', img: 'https://image.tmdb.org/t/p/original/erIfLebijr9xdweNBIsb3t3h4Q4.jpg', summary: 'A coming-of-age story of a high-school senior and her turbulent relationship with her mother.' },
           { title: 'Little Women', img: 'https://m.media-amazon.com/images/I/71tG1NKyT8L.jpg', summary: 'Jo March reflects back and forth on her life, telling the beloved story of the March sisters.' },
           { title: 'La La Land', img: 'https://i.ebayimg.com/00/s/MTQxNFgxMDAw/z/OcsAAOSwpgRloPRO/$_57.JPG?set_id=8800005007', summary: 'Two aspiring artists in Los Angeles navigate their careers and relationship.' },
           { title: 'Dune', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRnpkgdKqfLSE2DMUUVPv0HWKEsqJ2VaPfDQw&s', summary: 'A noble family becomes embroiled in a war for control over the galaxy\'s most valuable asset.' },
           { title: 'Call Me by Your Name', img: 'https://upload.wikimedia.org/wikipedia/en/c/c9/CallMeByYourName2017.png', summary: 'A 17-year-old forms a life-changing bond with a research assistant in 1980s Italy.' },
           { title: 'Detachment', img: 'https://m.media-amazon.com/images/M/MV5BYjVkMzkxN2UtY2U3OC00ODBkLThkMjAtNGIxZjVkNTI4ODhhXkEyXkFqcGc@._V1_.jpg', summary: 'A substitute teacher who drifts from classroom to classroom finds a connection to the students and teachers during his latest assignment.' },
           { title: 'When Harry Met Sally...', img: 'https://m.media-amazon.com/images/I/61SuGcS9AvL.jpg', summary: 'Two friends argue over whether men and women can ever be just friends.' },
           { title: 'The Lion King', img: 'https://m.media-amazon.com/images/M/MV5BMjIwMjE1Nzc4NV5BMl5BanBnXkFtZTgwNDg4OTA1NzM@._V1_FMjpg_UX1000_.jpg', summary: 'A young lion prince flees his kingdom only to learn the true meaning of responsibility and bravery.' },
           { title: 'The French Dispatch', img: 'https://m.media-amazon.com/images/M/MV5BMTU1YmNkZWYtYmExNC00YWE1LTk2NWEtMTQ2ODhmYTA5MmZiXkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg', summary: 'A love letter to journalists set in an outpost of an American newspaper in a fictional 20th-century French city.' },
           { title: 'Notting Hill', img: 'https://m.media-amazon.com/images/M/MV5BZjY3YWI5OTMtYTdlNy00ZTRlLTk0YjItN2M1MGVkMDM4ZDExXkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg', summary: 'The life of a simple bookshop owner is changed when he meets the most famous film star in the world.' },
           { title: 'Aladdin', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSAgcJ915nGS-NAey7TpuUkADHG2HAvXPn_8A&s', summary: 'A kind-hearted street urchin and a power-hungry Grand Vizier vie for a magic lamp that has the power to make their deepest wishes come true.' },
           { title: 'Amélie', img: 'https://upload.wikimedia.org/wikipedia/en/5/53/Amelie_poster.jpg', summary: 'A whimsical Parisian waitress decides to discreetly orchestrate the lives of those around her.' },
           { title: 'Spirited Away', img: 'https://m.media-amazon.com/images/M/MV5BNTEyNmEwOWUtYzkyOC00ZTQ4LTllZmUtMjk0Y2YwOGUzYjRiXkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg', summary: 'During her family\'s move to the suburbs, a sullen 10-year-old girl wanders into a world ruled by gods, witches, and spirits.' },
           { title: '10 Things I Hate About You', img: 'https://m.media-amazon.com/images/M/MV5BOTQwYmRhNGQtODI2Mi00ZTRlLTk0Y2QtY2NkNjE1MGNhNTgwXkEyXkFqcGc@._V1_.jpg', summary: 'A high-school boy, Cameron, cannot date Bianca until her ill-tempered older sister, Kat, has a boyfriend.' },
           { title: 'The Grand Budapest Hotel', img: 'https://s3.amazonaws.com/nightjarprod/content/uploads/sites/192/2023/05/01121042/eWdyYQreja6JGCzqHWXpWHDrrPo.jpg', summary: 'The adventures of a legendary concierge at a famous hotel from the fictional Republic of Zubrowka between the first and second World Wars.' },
           { title: 'Little Miss Sunshine', img: 'https://upload.wikimedia.org/wikipedia/en/1/16/Little_miss_sunshine_poster.jpg', summary: 'A family determined to get their young daughter into the finals of a beauty pageant take a cross-country trip in their VW bus.' },
           { title: 'Pulp Fiction', img: 'https://m.media-amazon.com/images/M/MV5BYTViYTE3ZGQtNDBlMC00ZTAyLTkyODMtZGRiZDg0MjA2YThkXkEyXkFqcGc@._V1_.jpg', summary: 'The lives of two mob hitmen, a boxer, a gangster and his wife, and a pair of diner bandits intertwine in four tales of violence and redemption.' }
        ];

        let currentPage = 0;
        const moviesPerPage = 4;

        function displayMovies() {
            const movieGrid = document.querySelector('.movie-grid');
            movieGrid.innerHTML = ''; // Clear the grid

            const start = currentPage * moviesPerPage;
            const end = start + moviesPerPage;
            const currentMovies = movies.slice(start, end);

            const watchedList = JSON.parse(localStorage.getItem('filmFolioWatchedList')) || [];
            const toWatchList = JSON.parse(localStorage.getItem('filmFolioWatchList')) || [];

            currentMovies.forEach(movie => {
                const isWatched = watchedList.some(watchedMovie => watchedMovie.title === movie.title);
                const isToWatch = toWatchList.includes(movie.title);

                const movieCard = `
                    <div class="movie-card" data-title="${movie.title}">
                        <img src="${movie.img}" alt="${movie.title}">
                        <div class="movie-overlay">
                            <h3>${movie.title}</h3>
                            <div class="overlay-buttons">
                                <button class="watched-btn ${isWatched ? 'added' : ''}" data-title="${movie.title}">${isWatched ? 'Watched ✓' : 'Watched'}</button>
                                <button class="towatch-btn ${isToWatch ? 'added' : ''}" data-title="${movie.title}">${isToWatch ? 'Added ✓' : 'To Watch'}</button>
                            </div>
                        </div>
                    </div>`;
                movieGrid.innerHTML += movieCard;
            });
        }

        function setupModal() {
            const modal = document.getElementById('movie-detail-modal');
            const closeBtn = modal.querySelector('.modal-close');
            const saveReviewBtn = document.getElementById('modal-save-review-btn');
            const addToListBtn = document.getElementById('modal-add-to-list-btn');

            // Open modal when a movie card is clicked
            document.querySelector('.movie-grid').addEventListener('click', function(e) {
                // If a button inside the overlay was clicked, handle that action first.
                if (e.target.classList.contains('towatch-btn')) {
                    e.stopPropagation(); // Prevent modal from opening
                    const button = e.target;
                    const movieTitle = button.dataset.title;
                    let toWatchList = JSON.parse(localStorage.getItem('filmFolioWatchList')) || [];
                    if (!toWatchList.includes(movieTitle)) {
                        toWatchList.push(movieTitle);
                        localStorage.setItem('filmFolioWatchList', JSON.stringify(toWatchList));
                        button.textContent = 'Added ✓';
                        button.classList.add('added');
                        showPopup('Added to your list!');
                    }
                    return; // Stop further execution
                }

                if (e.target.classList.contains('watched-btn')) {
                    e.stopPropagation(); // Prevent modal from opening
                    const button = e.target;
                    const movieTitle = button.dataset.title;
                    let watchedList = JSON.parse(localStorage.getItem('filmFolioWatchedList')) || [];
                    const isAlreadyWatched = watchedList.some(movie => movie.title === movieTitle);

                    if (!isAlreadyWatched) {
                        saveMovieReview(movieTitle, 0, ''); // Save with no rating/review
                        button.textContent = 'Watched ✓';
                        button.classList.add('added');
                        showPopup('Added to Watched!');
                    }
                    return; // Stop further execution
                }

                const movieCard = e.target.closest('.movie-card');
                if (movieCard) {
                    const movieTitle = movieCard.dataset.title;
                    const movieData = movies.find(m => m.title === movieTitle);
                    
                    // Populate modal
                    document.getElementById('modal-movie-img').src = movieData.img;
                    document.getElementById('modal-movie-title').textContent = movieData.title;
                    document.getElementById('modal-movie-summary').textContent = movieData.summary;

                    // Populate existing review data
                    const watchedList = JSON.parse(localStorage.getItem('filmFolioWatchedList')) || [];
                    const existingReview = watchedList.find(m => m.title === movieTitle);
                    document.getElementById('modal-movie-review').value = existingReview ? existingReview.review : '';

                    // Populate rating stars
                    const rating = existingReview ? existingReview.rating : 0;
                    const starsContainer = modal.querySelector('.rating-stars');
                    starsContainer.innerHTML = [5, 4, 3, 2, 1].map(star => `
                        <input type="radio" id="modal-star${star}" name="modal-rating" value="${star}" ${rating === star ? 'checked' : ''} /><label for="modal-star${star}">&#9733;</label>
                    `).join('');

                    // Update button states
                    const toWatchList = JSON.parse(localStorage.getItem('filmFolioWatchList')) || [];
                    addToListBtn.textContent = toWatchList.includes(movieTitle) ? 'On Your List ✓' : 'Add to List';
                    addToListBtn.classList.toggle('added', toWatchList.includes(movieTitle));
                    saveReviewBtn.dataset.title = movieTitle;
                    addToListBtn.dataset.title = movieTitle;

                    modal.style.display = 'flex';
                }
            });

            // Close modal logic
            const closeModal = () => modal.style.display = 'none';
            closeBtn.onclick = closeModal;
            window.onclick = (event) => {
                if (event.target == modal) closeModal();
            };

            // Save review button logic
            saveReviewBtn.addEventListener('click', function() {
                const movieTitle = this.dataset.title;
                const reviewText = document.getElementById('modal-movie-review').value;
                const ratingInput = modal.querySelector('input[name="modal-rating"]:checked');
                const rating = ratingInput ? parseInt(ratingInput.value) : 0;

                saveMovieReview(movieTitle, rating, reviewText);
                closeModal();
            });

            // Add to list button logic
            addToListBtn.addEventListener('click', function() {
                const movieTitle = this.dataset.title;
                let toWatchList = JSON.parse(localStorage.getItem('filmFolioWatchList')) || [];
                if (!toWatchList.includes(movieTitle)) {
                    toWatchList.push(movieTitle);
                    localStorage.setItem('filmFolioWatchList', JSON.stringify(toWatchList));
                    this.textContent = 'On Your List ✓';
                    this.classList.add('added');
                    showPopup('Added to your list!');
                }
            });
        }

        document.getElementById('popup-notification').addEventListener('click', function() {
            this.classList.remove('show');
        });

        document.getElementById('next-button').addEventListener('click', () => {
            if ((currentPage + 1) * moviesPerPage < movies.length) {
                currentPage++;
                displayMovies();
            }
        });

        document.getElementById('prev-button').addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                displayMovies();
            }
        });
   </script>

    <footer class="footer">
        <p>&copy; 2023 FilmFolio. All rights reserved. Designed with <a href="#">passion</a>.</p>
    </footer>
</body>
</html>